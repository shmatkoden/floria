<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–ª–∏—à–∏—Ç–∏ –∑–∞—è–≤–∫—É!</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1>–ó–∞–ª–∏—à–∏—Ç–∏ –∑–∞—è–≤–∫—É!</h1>
    
    <div class="container">
        <div class="product" data-product="–ö–æ–º–ø–ª–µ–∫—Ç (–°–∏–Ω—ñ–π)" data-price="599 –≥—Ä–Ω">
            <img src="/images/bluecolor.png" alt="–°–∏–Ω—ñ–π –∫–æ–º–ø–ª–µ–∫—Ç">
            <div class="product-info">
                <h2>–ö–æ–º–ø–ª–µ–∫—Ç (–°–∏–Ω—ñ–π)</h2>
                <p>–¶—ñ–Ω–∞: 599 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>

        <div class="product" data-product="–ö–æ–º–ø–ª–µ–∫—Ç (–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π)" data-price="649 –≥—Ä–Ω">
            <img src="/images/violetecolor.png" alt="–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π –∫–æ–º–ø–ª–µ–∫—Ç">
            <div class="product-info">
                <h2>–ö–æ–º–ø–ª–µ–∫—Ç (–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π)</h2>
                <p>–¶—ñ–Ω–∞: 649 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>

        <div class="product" data-product="–ö–æ–º–ø–ª–µ–∫—Ç (–û—Ä–∞–Ω–∂–µ–≤–∏–π)" data-price="699 –≥—Ä–Ω">
            <img src="/images/orangecolor.png" alt="–û—Ä–∞–Ω–∂–µ–≤–∏–π –∫–æ–º–ø–ª–µ–∫—Ç">
            <div class="product-info">
                <h2>–ö–æ–º–ø–ª–µ–∫—Ç (–û—Ä–∞–Ω–∂–µ–≤–∏–π)</h2>
                <p>–¶—ñ–Ω–∞: 699 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>

        <div class="product" data-product="–ö–æ–º–ø–ª–µ–∫—Ç (–°–∫–ª–∞–¥–Ω–∏–π)" data-price="749 –≥—Ä–Ω">
            <img src="/images/difficultcolor.png" alt="–°–∫–ª–∞–¥–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Ç">
            <div class="product-info">
                <h2>–ö–æ–º–ø–ª–µ–∫—Ç (–°–∫–ª–∞–¥–Ω–∏–π)</h2>
                <p>–¶—ñ–Ω–∞: 749 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>
    </div>

    <div id="overlay"></div>

    <form method="post" id="form" class="hidden">
        <h2 id="selectedProduct">–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä</h2>
        <input type="hidden" name="product" id="productInput">
        <input type="hidden" name="price" id="priceInput">

        <div class="row">
            <label>üôÇ –ü–Ü–ë</label>
            <input type="text" name="name" placeholder="–Ü–≤–∞–Ω –Ü–≤–∞–Ω–µ–Ω–∫–æ" required 
                   autofocus autocomplete="off" minlength="2" maxlength="50" />
        </div>

        <div class="row">
            <label>ü§ô –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
            <input type="text" name="phone" placeholder="+38..." required 
                   autocomplete="off" minlength="10" maxlength="13" 
                   pattern="\+38[0-9]{10}" title="–§–æ—Ä–º–∞—Ç: +380XXXXXXXXX" />
        </div>

        <div class="row">
            <label>üì¶ –°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <select name="delivery" id="delivery" required>
                <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç</option>
                <option value="–ù–æ–≤–∞ –ø–æ—à—Ç–∞">–ù–æ–≤–∞ –ø–æ—à—Ç–∞</option>
                <option value="–£–∫—Ä–ø–æ—à—Ç–∞">–£–∫—Ä–ø–æ—à—Ç–∞</option>
            </select>
        </div>

        <div class="row hidden" id="novaPoshtaDetails">
            <label>üèô –ú—ñ—Å—Ç–æ/–°–µ–ª–æ</label>
            <input type="text" name="city" placeholder="–ö–∏—ó–≤" />
            <label>üìç –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</label>
            <input type="text" name="branch" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è" />
        </div>

        <div class="row hidden" id="ukrPoshtaDetails">
            <label>üì¨ –ü–æ—à—Ç–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å</label>
            <input type="text" name="index" placeholder="01001" pattern="[0-9]{5}" />
        </div>

        <div class="row">
            <label>üîß –°–ø–æ—Å—ñ–± –∑–±–∏—Ä–∞–Ω–Ω—è</label>
            <select name="assembly" required>
                <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç</option>
                <option value="–ó—ñ–±—Ä–∞–Ω–∏–π">–ó—ñ–±—Ä–∞–Ω–∏–π - 485 –≥—Ä–Ω</option>
                <option value="–°–∞–º–æ—Å—Ç—ñ–π–Ω–µ –∑–±–∏—Ä–∞–Ω–Ω—è">–°–∞–º–æ—Å—Ç—ñ–π–Ω–µ –∑–±–∏—Ä–∞–Ω–Ω—è - 370 –≥—Ä–Ω</option>
            </select>
        </div>

        <div class="row">
            <input type="submit" value="üëâ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏">
            <button type="button" id="cancelButton">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </form>

    <p id="responseMessage"></p>
    
    <script>
        const URL_APP = "https://script.google.com/macros/s/AKfycbzhAclGY4oDsnMfN8E_cMsW5Z6kE8ezK2auQkWGNmjZKjXjVzLO_4hI4__U_FsXlAG3/exec";
    
        const form = document.querySelector("#form");
        const overlay = document.querySelector("#overlay");
        const buyButtons = document.querySelectorAll(".buyButton");
        const cancelButton = document.querySelector("#cancelButton");
        const selectedProduct = document.querySelector("#selectedProduct");
        const productInput = document.querySelector("#productInput");
        const priceInput = document.querySelector("#priceInput");
        const deliverySelect = document.querySelector("#delivery");
        const novaPoshtaDetails = document.querySelector("#novaPoshtaDetails");
        const ukrPoshtaDetails = document.querySelector("#ukrPoshtaDetails");
        const responseMessage = document.getElementById("responseMessage");
    
        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–∞
        buyButtons.forEach(button => {
            button.addEventListener("click", (event) => {
                const product = event.target.closest(".product");
                if (product) {
                    selectedProduct.innerText = `–í–∏ –æ–±—Ä–∞–ª–∏: ${product.dataset.product}`;
                    productInput.value = product.dataset.product;
                    priceInput.value = product.dataset.price;
                    form.style.display = "block";
                    overlay.style.display = "block";
                } else {
                    console.error("Product element not found.");
                }
            });
        });
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–°–∫–∞—Å—É–≤–∞—Ç–∏"
        cancelButton.addEventListener("click", () => {
            closeForm();
        });
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏ —Ñ–æ—Ä–º—ã
        overlay.addEventListener("click", (event) => {
            if (event.target === overlay) {
                closeForm();
            }
        });
    
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã
        function closeForm() {
            form.style.display = "none";
            overlay.style.display = "none";
            form.reset();
            novaPoshtaDetails.style.display = "none";
            ukrPoshtaDetails.style.display = "none";
        }
    
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏
        deliverySelect.addEventListener("change", () => {
            if (deliverySelect.value === "–ù–æ–≤–∞ –ø–æ—à—Ç–∞") {
                novaPoshtaDetails.style.display = "block";
                ukrPoshtaDetails.style.display = "none";
            } else if (deliverySelect.value === "–£–∫—Ä–ø–æ—à—Ç–∞") {
                ukrPoshtaDetails.style.display = "block";
                novaPoshtaDetails.style.display = "none";
            } else {
                novaPoshtaDetails.style.display = "none";
                ukrPoshtaDetails.style.display = "none";
            }
        });
    
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        form.addEventListener("submit", async (ev) => {
            ev.preventDefault();
    
            const name = document.querySelector("[name=name]").value.trim();
            const phone = document.querySelector("[name=phone]").value.trim();
            const delivery = document.querySelector("[name=delivery]").value;
            const city = document.querySelector("[name=city]")?.value.trim() || "";
            const branch = document.querySelector("[name=branch]")?.value.trim() || "";
            const index = document.querySelector("[name=index]")?.value.trim() || "";
            const assembly = document.querySelector("[name=assembly]").value;
            const product = productInput.value;
            const price = priceInput.value;
    
            let deliveryDetails = delivery === "–ù–æ–≤–∞ –ø–æ—à—Ç–∞" ? `–ú—ñ—Å—Ç–æ: ${city}, –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è: ${branch}` : `–Ü–Ω–¥–µ–∫—Å: ${index}`;
    
            let details = {
                name,
                phone,
                delivery,
                deliveryDetails,
                assembly,
                product,
                price
            };
    
            let formBody = Object.keys(details)
                .map(key => encodeURIComponent(key) + "=" + encodeURIComponent(details[key]))
                .join("&");
    
            try {
                const response = await fetch(URL_APP, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
                    body: formBody,
                });
    
                const result = await response.json();
    
                if (result.type === "success") {
                    responseMessage.style.color = "green";
                    responseMessage.innerText = "–î—è–∫—É—î–º–æ –∑–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É!";
                } else {
                    responseMessage.style.color = "red";
                    responseMessage.innerText = `–ü–æ–º–∏–ª–∫–∞: ${result.errors}`;
                }
            } catch (error) {
                responseMessage.style.color = "red";
                responseMessage.innerText = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –¥–∞–Ω–∏—Ö.";
            }
    
            closeForm();
        });
    </script>

</body>
</html>