<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–ª–∏—à–∏—Ç–∏ –∑–∞—è–≤–∫—É!</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1>–ú–∞–≥–∞–∑–∏–Ω Floria</h1>
    <div class="video-container">
        <video autoplay loop muted playsinline>
            <source src="/images/IMG_0679.MP4" type="video/mp4">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–≥ –≤–∏–¥–µ–æ.
        </video>
    </div>
    
    <div class="container">
        <div class="product" data-product="–¢—é–ª—å–ø–∞–Ω–∏ (–°–∏–Ω—ñ–π)" data-price="370/485 –≥—Ä–Ω">
            <img src="/images/bluecolor.png" alt="–°–∏–Ω—ñ–π —Ç—é–ª—å–ø–∞–Ω">
            <div class="product-info">
                <h2>–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</h2>
                <p>–¶—ñ–Ω–∞: 370 –≥—Ä–Ω</p>
                <p>–¶—ñ–Ω–∞ –ó–Ü–ë–†–ê–ù–û–ì–û: 520 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>

        <div class="product" data-product="–¢—é–ª—å–ø–∞–Ω–∏ (–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π)" data-price="370/485 –≥—Ä–Ω">
            <img src="/images/violetecolor.png" alt="–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π —Ç—é–ª—å–ø–∞–Ω">
            <div class="product-info">
                <h2>–¢—é–ª—å–ø–∞–Ω (–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π)</h2>
                <p>–¶—ñ–Ω–∞: 370 –≥—Ä–Ω</p>
                <p>–¶—ñ–Ω–∞ –ó–Ü–ë–†–ê–ù–û–ì–û: 520 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>

        <div class="product" data-product="–¢—é–ª—å–ø–∞–Ω–∏ (–û—Ä–∞–Ω–∂–µ–≤–∏–π)" data-price="370/485 –≥—Ä–Ω">
            <img src="/images/orangecolor.png" alt="–û—Ä–∞–Ω–∂–µ–≤–∏–π —Ç—é–ª—å–ø–∞–Ω">
            <div class="product-info">
                <h2>–¢—é–ª—å–ø–∞–Ω (–û—Ä–∞–Ω–∂–µ–≤–∏–π)</h2>
                <p>–¶—ñ–Ω–∞: 370 –≥—Ä–Ω</p>
                <p>–¶—ñ–Ω–∞ –ó–Ü–ë–†–ê–ù–û–ì–û: 520 –≥—Ä–Ω</p>
            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>

        <div class="product" data-product="–¢—é–ª—å–ø–∞–Ω–∏ (–†—ñ–∑–Ω–æ–∫–æ–ª—å–æ—Ä–æ–≤–∏–π)" data-price="370/485 –≥—Ä–Ω">
            <img src="/images/dif.jpg" alt="–†—ñ–∑–Ω–æ–∫–æ–ª—å–æ—Ä–æ–≤–∏–π —Ç—é–ª—å–ø–∞–Ω">
            <div class="product-info">
                <h2>–ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</h2>
                <p>–¶—ñ–Ω–∞: 370 –≥—Ä–Ω</p>
                <p>–¶—ñ–Ω–∞ –ó–Ü–ë–†–ê–ù–û–ì–û: 520 –≥—Ä–Ω</p>

            </div>
            <button class="buyButton">–ö—É–ø–∏—Ç–∏</button>
        </div>
    </div>

    <div id="overlay"></div>

    <form method="post" id="form" class="hidden">
        <h2 id="selectedProduct">–û–±–µ—Ä—ñ—Ç—å —Ç–æ–≤–∞—Ä</h2>
        <input type="hidden" name="product" id="productInput">
        <input type="hidden" name="price" id="priceInput">

        <div class="row">
            <label>üôÇ –ü–Ü–ë</label>
            <input type="text" name="name" placeholder="–Ü–≤–∞–Ω –Ü–≤–∞–Ω–µ–Ω–∫–æ" required 
                   autofocus autocomplete="off" minlength="2" maxlength="50" />
        </div>

        <div class="row">
            <label>ü§ô –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
            <input type="text" name="phone" placeholder="+38..." required 
                   autocomplete="off" minlength="10" maxlength="12" 
                   />
        </div>

        <div class="row">
            <label>üì¶ –°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <select name="delivery" id="delivery" required>
                <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç</option>
                <option value="–ù–æ–≤–∞ –ø–æ—à—Ç–∞">–ù–æ–≤–∞ –ø–æ—à—Ç–∞</option>
                <option value="–£–∫—Ä–ø–æ—à—Ç–∞">–£–∫—Ä–ø–æ—à—Ç–∞</option>
            </select>
        </div>

        <div class="row hidden" id="novaPoshtaDetails">
            <label>üèô –ú—ñ—Å—Ç–æ/–°–µ–ª–æ</label>
            <input type="text" name="city" placeholder="–ö–∏—ó–≤" />
            <label>üìç –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</label>
            <input type="text" name="branch" placeholder="‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è" />
        </div>

        <div class="row hidden" id="ukrPoshtaDetails">
            <label>üì¨ –ü–æ—à—Ç–æ–≤–∏–π —ñ–Ω–¥–µ–∫—Å</label>
            <input type="text" name="index" placeholder="01001" pattern="[0-9]{5}" />
        </div>

        <div class="row">
            <label>üîß –°–ø–æ—Å—ñ–± –∑–±–∏—Ä–∞–Ω–Ω—è</label>
            <select name="assembly" required>
                <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç</option>
                <option value="–ó—ñ–±—Ä–∞–Ω–∏–π">–ó—ñ–±—Ä–∞–Ω–∏–π - 485 –≥—Ä–Ω</option>
                <option value="–°–∞–º–æ—Å—Ç—ñ–π–Ω–µ –∑–±–∏—Ä–∞–Ω–Ω—è">–°–∞–º–æ—Å—Ç—ñ–π–Ω–µ –∑–±–∏—Ä–∞–Ω–Ω—è - 370 –≥—Ä–Ω</option>
            </select>
        </div>

        <div class="row">
            <input type="submit" value="üëâ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏">
            <button type="button" id="cancelButton">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </form>
    <div id="messageModal" class="hidden">
        <div class="modal-content">
            <p>‚ò∫Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ —Ç—é–ª—å–ø–∞–Ω–∏ –ø—ñ–¥ —á–∞—Å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞ –ø–æ—à—Ç—ñ. –£ —Ä–∞–∑—ñ –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç—Ä—ñ—â–∏–Ω —á–∏ –ø–æ—à–∫–æ–¥–∂–µ–Ω—å –æ—Ñ–æ—Ä–º—ñ—Ç—å –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —è–∫ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä, —ñ –º–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ –Ω–∞–¥—ñ—à–ª–µ–º–æ –≤–∞–º –Ω–æ–≤–∏–π.</p>
            <p>üî∫ –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É: —è–∫—â–æ —Ç—é–ª—å–ø–∞–Ω–∏ –≤–∂–µ –∑–∞–±—Ä–∞–Ω—ñ –∑ –ø–æ—à—Ç–∏, –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –Ω–µ–º–æ–∂–ª–∏–≤–æ.</p>
            <p>üëÅÔ∏è‚Äçüó®Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∞: —Ç—é–ª—å–ø–∞–Ω–∏ –∑–∞–∫—Ä—ñ–ø–ª–µ–Ω—ñ –Ω–∞ –¥–Ω—ñ –∫–æ—Ä–æ–±–∫–∏, —Ç–æ–º—É –º–æ–∂–ª–∏–≤—ñ –Ω–µ–∑–Ω–∞—á–Ω—ñ –ø–æ–¥—Ä—è–ø–∏–Ω–∏ –∞–±–æ –ø–ª—è–º–∏ –Ω–∞ —Ü—ñ–π —á–∞—Å—Ç–∏–Ω—ñ ‚Äì —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞, –±–æ–∫–æ–≤—ñ —Å—Ç–æ—Ä–æ–Ω–∏ —Ç–∞ –≤–µ—Ä—Ö–Ω—é —á–∞—Å—Ç–∏–Ω—É.</p>
            <button id="closeMessage">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>
    
    <p id="responseMessage"></p>
    <div id="loadingSpinner" class="hidden">
        <p>–ó–∞—á–µ–∫–∞–π—Ç–µ, –æ–±—Ä–æ–±–∫–∞ –∑–∞—è–≤–∫–∏...</p>
    </div>
    
    <script>
        const URL_APP = "https://script.google.com/macros/s/AKfycbzhAclGY4oDsnMfN8E_cMsW5Z6kE8ezK2auQkWGNmjZKjXjVzLO_4hI4__U_FsXlAG3/exec";
    
        const form = document.querySelector("#form");
        const overlay = document.querySelector("#overlay");
        const buyButtons = document.querySelectorAll(".buyButton");
        const cancelButton = document.querySelector("#cancelButton");
        const selectedProduct = document.querySelector("#selectedProduct");
        const productInput = document.querySelector("#productInput");
        const priceInput = document.querySelector("#priceInput");
        const deliverySelect = document.querySelector("#delivery");
        const novaPoshtaDetails = document.querySelector("#novaPoshtaDetails");
        const ukrPoshtaDetails = document.querySelector("#ukrPoshtaDetails");
        const responseMessage = document.getElementById("responseMessage");
        const messageModal = document.querySelector("#messageModal");
        const closeMessage = document.querySelector("#closeMessage");
        const loadingSpinner = document.getElementById("loadingSpinner");
    
        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–∞
        buyButtons.forEach(button => {
            button.addEventListener("click", (event) => {
                const product = event.target.closest(".product");
                if (product) {
                    selectedProduct.innerText = `–í–∏ –æ–±—Ä–∞–ª–∏: ${product.dataset.product}`;
                    productInput.value = product.dataset.product;
                    priceInput.value = product.dataset.price;
                    form.style.display = "block";
                    overlay.style.display = "block";
                } else {
                    console.error("Product element not found.");
                }
            });
        });
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ "–°–∫–∞—Å—É–≤–∞—Ç–∏"
        cancelButton.addEventListener("click", () => {
            closeForm();
        });
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏ —Ñ–æ—Ä–º—ã
        overlay.addEventListener("click", (event) => {
            if (event.target === overlay) {
                closeForm();
            }
        });
    
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã
        function closeForm() {
            form.style.display = "none";
            overlay.style.display = "none";
            form.reset();
            novaPoshtaDetails.style.display = "none";
            ukrPoshtaDetails.style.display = "none";
        }
    
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏
        deliverySelect.addEventListener("change", () => {
            if (deliverySelect.value === "–ù–æ–≤–∞ –ø–æ—à—Ç–∞") {
                novaPoshtaDetails.style.display = "block";
                ukrPoshtaDetails.style.display = "none";
            } else if (deliverySelect.value === "–£–∫—Ä–ø–æ—à—Ç–∞") {
                ukrPoshtaDetails.style.display = "block";
                novaPoshtaDetails.style.display = "none";
            } else {
                novaPoshtaDetails.style.display = "none";
                ukrPoshtaDetails.style.display = "none";
            }
        });
    
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
        form.addEventListener("submit", async (ev) => {
            ev.preventDefault();
            loadingSpinner.classList.remove("hidden");
    
            const name = document.querySelector("[name=name]").value.trim();
            const phone = document.querySelector("[name=phone]").value.trim();
            const delivery = document.querySelector("[name=delivery]").value;
            const city = document.querySelector("[name=city]")?.value.trim() || "";
            const branch = document.querySelector("[name=branch]")?.value.trim() || "";
            const index = document.querySelector("[name=index]")?.value.trim() || "";
            const assembly = document.querySelector("[name=assembly]").value;
            const product = productInput.value;
            const price = priceInput.value;
    
            let deliveryDetails = delivery === "–ù–æ–≤–∞ –ø–æ—à—Ç–∞" ? `–ú—ñ—Å—Ç–æ: ${city}, –í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è: ${branch}` : `–Ü–Ω–¥–µ–∫—Å: ${index}`;
    
            let details = {
                name,
                phone,
                delivery,
                deliveryDetails,
                assembly,
                product,
                price
            };
    
            let formBody = Object.keys(details)
                .map(key => encodeURIComponent(key) + "=" + encodeURIComponent(details[key]))
                .join("&");
    
            try {
                const response = await fetch(URL_APP, {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
                    body: formBody,
                });
    
                const result = await response.json();
    
                if (result.type === "success") {
                    responseMessage.style.color = "green";
                    responseMessage.innerText = "–î—è–∫—É—î–º–æ –∑–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É!";
                    closeForm();
                    showMessageModal();
                } else {
                    responseMessage.style.color = "red";
                    responseMessage.innerText = `–ü–æ–º–∏–ª–∫–∞: ${result.errors}`;
                }
            } catch (error) {
                responseMessage.style.color = "red";
                responseMessage.innerText = "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –¥–∞–Ω–∏—Ö.";
            }
            loadingSpinner.classList.add("hidden");
        });
    
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
        function showMessageModal() {
            messageModal.style.display = "block";
        }
    
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        closeMessage.addEventListener("click", () => {
            messageModal.style.display = "none";
        });
    
    </script>
</body>
</html>